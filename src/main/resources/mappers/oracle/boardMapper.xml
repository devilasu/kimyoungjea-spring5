<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">
<!-- bno가 자동증가 필요. -->
<!-- 검색처리는 memberQuery에서 만든 내용 붙여넣기. -->
<sql id="sqlWhere">
	where	board_type = #{board_type}
<if test="search_type != '' and search_type != null">
	and(
	<if test="search_type == 'all'.toString()">
		title like '%'||#{search_keyword}||'%'
		or content like '%'||#{search_keyword}||'%')
	</if>
	<if test="search_type == 'title'.toString()">
		title like '%'||#{search_keyword}||'%')
	</if>
	<if test="search_type == 'content'.toString()">
		content like '%'||#{search_keyword}||'%') 
	</if>
</if>
</sql>

<insert id="insertBoard">
insert into tbl_board(
	BNO, title, content, writer, reg_date, update_date, board_type
)
values(
<selectKey keyProperty = "seq_bno" resultType="int" order="BEFORE">
	select seq_bno.nextval from dual
</selectKey>,
#{title},
#{mainCont},
#{writer},
systimestamp,
systimestamp,
#{boardType}
)
</insert>

<select id="selectBoard" resultType="com.edu.vo.BoardVO">
select TABLE_B.* from
(
	select ROWNUM as RNUM, TABLE_A.* from
	(
		select * from tbl_board
		<include refid="sqlWhere" />
		order by BNO DESC
	) TABLE_A
	<![CDATA[
    where ROWNUM <= #{queryStartNum}+#{queryPerPageNum}
) TABLE_B
where TABLE_B.RNUM > #{queryStartNum}
]]>
</select>

</mapper>